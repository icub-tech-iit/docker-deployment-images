name: Devel

on: 
    workflow_dispatch:
    schedule:
    # Run the job once a week
    - cron: '0 0 * * 0'
    
jobs:
  build:
    name: build devel and master images
    runs-on: ubuntu-latest
    steps:
      # - name: Get Token
      #   id: get_workflow_token
      #   uses: tibdex/github-app-token@v2
      #   with:
      #     private_key: ${{ secrets.APPLICATION_PRIVATE_KEY  }}
      #     app_id: ${{ secrets.APPLICATION_ID  }}
      #     installation_retrieval_mode: repository
      #     installation_retrieval_payload: icub-tech-iit/code
      - name: Checkout docker-deployment-images
        uses: actions/checkout@v4
        
      - name: Repository Dispatch for building images
        uses: peter-evans/repository-dispatch@v3
        # env:
        #   GITHUB_APPS_TOKEN: ${{ steps.get_workflow_token.outputs.token }}
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          event-type: cron_trigger
          client-payload: '{"version": "master", "type": "cron_trigger", "img_list": "superbuild superbuild-icubhead superbuild-icubhead-withuser superbuild-gazebo superbuild-ros2"}'
